# Початкове налаштування сервера з Ubuntu 22.04

Коли ви вперше створюєте новий сервер Ubuntu 22.04, вам слід виконати деякі важливі кроки конфігурації як частину початкового налаштування. Ці кроки підвищать безпеку та зручність використання вашого сервера та дадуть міцну основу для подальших дій.

Розгортайте свої програми з GitHub за допомогою платформи додатків DigitalOcean . Дозвольте DigitalOcean зосередитися на масштабуванні вашої програми.

## Крок 1 — Увійдіть як root
Щоб увійти на свій сервер, вам потрібно буде знати загальнодоступну IP-адресу вашого сервера . Вам також знадобиться пароль або закритий ключ для облікового запису користувача root , якщо ви встановили ключ SSH для автентифікації. Якщо ви ще не ввійшли на свій сервер, ви можете слідувати нашому посібнику про підключення до Droplets за допомогою SSH , який детально описує цей процес.

Якщо ви зараз не підключені до свого сервера, увійдіть як користувач root за допомогою такої команди. Замініть виділену your_server_ipчастину команди публічною IP-адресою вашого сервера:

ssh root@your_server_ip
Прийміть попередження про автентичність хоста, якщо воно з’явиться. Якщо на вашому сервері використовується автентифікація за паролем, укажіть пароль root для входу. Якщо ви використовуєте ключ SSH, захищений парольною фразою, вам може знадобитися вводити парольну фразу під час першого використання ключа кожного сеансу. Якщо ви вперше входите на сервер із паролем, вам також може знадобитися змінити пароль root . Дотримуйтеся вказівок, щоб змінити пароль, якщо з’явиться запит.

Про корінь
Користувач root — це користувач-адміністратор у середовищі Linux із підвищеними привілеями. Через підвищені привілеї облікового запису root вам не рекомендується використовувати його регулярно. Коренева обліковий запис може внести дуже руйнівні зміни, навіть випадково.

Наступним кроком є ​​налаштування нового облікового запису користувача зі зниженими правами для повсякденного використання. Пізніше ми покажемо вам, як тимчасово отримати додаткові привілеї на час, коли вони вам потрібні.

## Крок 2 — Створення нового користувача
Увійшовши як root , ви зможете додати новий обліковий запис користувача. У майбутньому ми входитимемо за допомогою цього нового облікового запису замість root .

У цьому прикладі створюється новий користувач під назвою sammy , але ви повинні замінити його на ім’я користувача, яке вам подобається:

adduser sammy
Вам буде запропоновано кілька запитань, починаючи з пароля облікового запису.

Введіть надійний пароль і, за бажанням, заповніть будь-яку додаткову інформацію, якщо хочете. Ця інформація не потрібна, і ви можете натиснути ENTERбудь-яке поле, яке хочете пропустити.

Крок 3 — Надання адміністративних привілеїв
Тепер у вас є новий обліковий запис користувача зі звичайними привілеями облікового запису. Однак іноді вам доведеться виконувати адміністративні завдання як користувач root .

Щоб уникнути виходу зі свого звичайного користувача та повторного входу як обліковий запис root , ви можете встановити так звані права суперкористувача або права root для звичайного облікового запису вашого користувача. Ці привілеї дозволять вашому звичайному користувачеві виконувати команди з правами адміністратора, поставивши слово sudoперед командою.

Щоб додати ці привілеї новому користувачеві, вам потрібно буде додати його до системної групи sudo . За замовчуванням в Ubuntu 22.04 користувачі, які є членами групи sudo , можуть використовувати sudoкоманду.

Від імені root виконайте цю команду, щоб додати нового користувача до групи sudo (замініть виділене sammyім’я користувача своїм новим користувачем):

usermod -aG sudo sammy
Тепер ви можете вводити sudoперед командами, щоб запускати їх із правами суперкористувача, увійшовши як звичайний користувач.

Крок 4 — Налаштування брандмауера
Сервери Ubuntu 22.04 можуть використовувати брандмауер UFW, щоб дозволити підключення лише до певних служб. За допомогою цієї програми можна налаштувати базовий брандмауер.

Примітка. Якщо ваші сервери працюють на DigitalOcean, ви можете додатково використовувати хмарні брандмауери DigitalOcean замість брандмауера UFW. Ми рекомендуємо використовувати лише один брандмауер за раз, щоб уникнути конфлікту правил, які може бути важко налагодити.

Програми можуть реєструвати свої профілі в UFW після встановлення. Ці профілі дозволяють UFW керувати програмами за іменами. OpenSSH, сервіс, який дозволяє підключатися до вашого сервера, має профіль, зареєстрований в UFW.

Ви можете переглянути список встановлених профілів UFW, ввівши:

ufw app list
Output
Available applications:
  OpenSSH
Вам потрібно буде переконатися, що брандмауер дозволяє з’єднання SSH, щоб наступного разу ви могли увійти на свій сервер. Дозвольте ці підключення, ввівши:

ufw allow OpenSSH
Тепер увімкніть брандмауер, ввівши:

ufw enable
Введіть yі натисніть ENTER, щоб продовжити. Ви можете побачити, що з’єднання SSH все ще дозволені, ввівши:

ufw status
Output
Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
Наразі брандмауер блокує всі з’єднання, крім SSH . Якщо ви встановите та налаштуєте додаткові служби, вам потрібно буде налаштувати параметри брандмауера, щоб дозволити новий трафік на ваш сервер. Ви можете дізнатися про деякі поширені операції UFW у нашому посібнику з основ UFW .

Крок 5 — Увімкнення зовнішнього доступу для вашого звичайного користувача
Тепер, коли у вас є звичайний користувач для щоденного використання, вам потрібно переконатися, що ви можете підключитися до облікового запису безпосередньо через SSH.

Примітка: доки не буде перевірено, що ви можете увійти та використовувати sudoз новим користувачем, ми рекомендуємо залишатися в системі як root . Якщо у вас виникли проблеми з підключенням, ви можете вирішити проблему та внести необхідні зміни від імені користувача root . Якщо ви використовуєте DigitalOcean Droplet і маєте проблеми з кореневим з’єднанням SSH, ви можете відновити доступ до Droplets за допомогою консолі відновлення .

Налаштування доступу SSH для вашого нового користувача залежить від того, чи використовує кореневий обліковий запис вашого сервера пароль або ключі SSH для автентифікації.

Якщо обліковий запис root використовує автентифікацію за паролем
Якщо ви ввійшли у свій обліковий запис root за допомогою пароля, то для SSH увімкнено автентифікацію за паролем . Ви можете використовувати SSH для свого нового облікового запису користувача, відкривши новий сеанс терміналу та використовуючи SSH із вашим новим іменем користувача:

ssh sammy@your_server_ip
Після введення пароля звичайного користувача ви ввійдете в систему. Пам’ятайте, якщо вам потрібно запустити команду з правами адміністратора, введіть sudoперед нею так:

sudo command_to_run
sudoПід час першого використання кожного сеансу (і періодично після цього) ви отримуватимете запит на введення пароля свого звичайного користувача .

Щоб підвищити безпеку вашого сервера, ми наполегливо рекомендуємо налаштувати ключі SSH замість використання автентифікації за паролем . Дотримуйтеся нашого посібника з налаштування ключів SSH на Ubuntu 22.04 , щоб дізнатися, як налаштувати автентифікацію на основі ключів.

Якщо обліковий запис root використовує автентифікацію ключа SSH
Якщо ви ввійшли до свого кореневого облікового запису за допомогою ключів SSH , автентифікація пароля для SSH вимкнена . Щоб увійти як звичайний користувач за допомогою ключа SSH, потрібно додати копію свого локального відкритого ключа до файлу нового користувача ~/.ssh/authorized_keys.

Оскільки ваш відкритий ключ уже міститься у файлі кореневого облікового запису ~/.ssh/authorized_keysна сервері, ви можете скопіювати цей файл і структуру каталогу до свого нового облікового запису користувача за допомогою поточного сеансу.

Найпростіший спосіб скопіювати файли з правильним правом власності та дозволами — за допомогою rsyncкоманди. Ця команда скопіює каталог кореневого користувача .ssh, збереже дозволи та змінить власників файлів за допомогою однієї команди. Переконайтеся, що виділені частини команди нижче відповідають імені вашого звичайного користувача:

Примітка. Ця rsyncкоманда обробляє джерела та призначення, які закінчуються косою рискою в кінці, інакше, ніж ті, які не мають кінцевої косої риски. У разі використання rsyncнижче переконайтеся, що вихідний каталог ( ~/.ssh) не містить косу риску в кінці (переконайтеся, що ви не використовуєте ~/.ssh/).

Якщо ви випадково додасте кінцеву косу риску до команди, rsyncбуде скопійовано вміст каталогу кореневого облікового запису ~/.sshдо sudoдомашнього каталогу користувача замість копіювання всієї ~/.sshструктури каталогу. Файли будуть у неправильному місці, і SSH не зможе їх знайти та використати.

rsync --archive --chown=sammy:sammy ~/.ssh /home/sammy
Тепер відкрийте новий термінальний сеанс на вашій локальній машині та використовуйте SSH зі своїм новим іменем користувача:

ssh sammy@your_server_ip
Ви повинні підключитися до свого сервера за допомогою нового облікового запису користувача без використання пароля. Пам’ятайте, якщо вам потрібно запустити команду з правами адміністратора, введіть sudoперед командою так:

sudo command_to_run
Вам буде запропоновано ввести пароль звичайного користувача під час sudoпершого використання кожного сеансу (і періодично після цього).


Updated on 2024-06-11

Updated on 2024-06-19

Updated on 2024-06-28

Updated on 2024-07-02

Updated on 2024-07-11

Updated on 2024-07-20

Updated on 2024-07-25

Updated on 2024-08-09

Updated on 2024-08-10

Updated on 2024-09-14